name: Push and Pull request
on:
  pull_request:
    branches: [master]
  push:
jobs:
  test:
    # should be case insensitive, both hotfix Hotfix prefix should work, Revert is generated by revert button so leave it with captial 'R'
    # only runs this check if branch name not start with the following pattern
    # if: ${{ !startsWith(github.ref_name, 'hotfix') && !startsWith(github.ref_name, 'Revert') && !startsWith(github.ref_name, 'dependabot') && !startsWith(github.head_ref, 'hotfix') && !startsWith(github.head_ref, 'Revert') && !startsWith(github.head_ref, 'dependabot') }}
    runs-on: ubuntu-latest
    env:
      SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
    steps:
      - name: Get code
        uses: actions/checkout@v3
      - name: Install NodeJS
        uses: actions/setup-node@v3
        with:
          node-version: 16
      - name: Install dependencies
        run: yarn install
      - name: Run test
        run: yarn test && echo ${{toJSON(github)}}

      # 测试先test再build，因为test花的时间少如果fail了可以节省一些资源。
      # 开发人员应该在hotfix时也本地运行test和build来测试是否报错，但是也应该添加pull request运行test1️以确保程序不崩溃。123
